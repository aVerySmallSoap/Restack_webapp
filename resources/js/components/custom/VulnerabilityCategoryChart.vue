<template>
  <Bar :data="chartData" :options="chartOptions" />
</template>

<script>
import { Bar } from 'vue-chartjs'
import { Chart as ChartJS, Title, Tooltip, BarElement, CategoryScale, LinearScale } from 'chart.js'

ChartJS.register(Title, Tooltip, BarElement, CategoryScale, LinearScale)

const vulnerabilities = [
    { scanner: 'Wapiti', category: 'SQL Injection', severity: 'High' },
    { scanner: 'Wapiti', category: 'Cross-Site Scripting', severity: 'Medium' },
    { scanner: 'Wapiti', category: 'Command Injection', severity: 'High' },
    { scanner: 'ZAP', category: 'SQL Injection', severity: 'Critical' },
    { scanner: 'ZAP', category: 'Cross-Site Scripting', severity: 'High' },
    { scanner: 'ZAP', category: 'Open Redirect', severity: 'Medium' },
    { scanner: 'Arachni', category: 'SQL Injection', severity: 'High' },
    { scanner: 'Arachni', category: 'Cross-Site Scripting', severity: 'Low' },
    { scanner: 'Arachni', category: 'Local File Inclusion', severity: 'Medium' },
    { scanner: 'Wapiti', category: 'Cross-Site Scripting', severity: 'Low' },
    { scanner: 'ZAP', category: 'CSRF', severity: 'Medium' },
    { scanner: 'Arachni', category: 'Remote Code Execution', severity: 'Critical' },
    { scanner: 'Wapiti', category: 'Open Redirect', severity: 'Low' },
    { scanner: 'ZAP', category: 'Path Traversal', severity: 'High' },
    { scanner: 'Arachni', category: 'Unvalidated Input', severity: 'Low' },
    { scanner: 'Wapiti', category: 'Command Injection', severity: 'Medium' },
    { scanner: 'ZAP', category: 'HTTP Response Splitting', severity: 'Medium' },
    { scanner: 'Arachni', category: 'Directory Listing', severity: 'Low' },
    { scanner: 'Wapiti', category: 'SQL Injection', severity: 'Medium' },
    { scanner: 'ZAP', category: 'Clickjacking', severity: 'Low' },
];

export default {
  name: 'VulnerabilityCategoryChart ',
  components: { Bar },
  data() {
    return {
      chartData: {
        labels: [],
        datasets: [
          {
            backgroundColor: [
              '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40',
              '#8A2BE2', '#DC143C', '#20B2AA', '#FFD700', '#ADFF2F', '#FF69B4'
            ],
            data: []
          }
        ]
      },
      chartOptions: {
        responsive: true,
        plugins: {
          legend: {
            display: false
          }
        }
      }
    }
  },
  created() {
    this.generateDummyVulnerabilityDataByCategory();
  },
  methods: {
    generateDummyVulnerabilityDataByCategory() {
      const categories = [...new Set(vulnerabilities.map(v => v.category))];
      const categoryCounts = {};

      categories.forEach(cat => {
        categoryCounts[cat] = 0;
      });

      categories.forEach(category => {
        categoryCounts[category] = Math.floor(Math.random() * 26) + 5;
      });

      this.chartData.labels = categories;
      this.chartData.datasets[0].data = categories.map(cat => categoryCounts[cat]);
    },

    processVulnerabilityDataByScanner() {
      const scannerCounts = {};

      vulnerabilities.forEach(vulnerability => {
        if (scannerCounts[vulnerability.scanner]) {
          scannerCounts[vulnerability.scanner]++;
        } else {
          scannerCounts[vulnerability.scanner] = 1;
        }
      });

      this.chartData.labels = Object.keys(scannerCounts);
      this.chartData.datasets[0].data = Object.values(scannerCounts);
    }
  }
}
</script>
